<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OJT Performance Assessment Matrix</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f9fafb; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #1f2937; margin-bottom: 10px; font-size: 32px; }
        h2 { color: #4b5563; font-size: 20px; margin-bottom: 30px; }
        .position-selector { margin: 30px 0; }
        .position-selector label { display: block; font-weight: 600; margin-bottom: 10px; color: #374151; }
        .position-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .position-btn { padding: 20px; border: 2px solid #e5e7eb; background: #f9fafb; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .position-btn:hover { background: #f3f4f6; }
        .position-btn.active { background: #2563eb; color: white; border-color: #2563eb; font-weight: bold; }
        .position-btn small { display: block; margin-top: 5px; opacity: 0.8; font-size: 12px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .form-group { background: #f9fafb; padding: 15px; border-radius: 8px; }
        .form-group label { display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #2563eb; ring: 2px solid rgba(37, 99, 235, 0.2); }
        .progress-bar { background: #dbeafe; border-left: 4px solid #2563eb; padding: 15px; border-radius: 6px; margin: 20px 0; }
        .progress-bar-fill { background: #e5e7eb; height: 8px; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .progress-bar-fill-inner { background: #2563eb; height: 100%; transition: width 0.3s; }
        .rating-scale { background: #f9fafb; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .rating-scale h3 { margin-bottom: 15px; font-size: 16px; }
        .rating-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .rating-item { padding: 12px; border-radius: 6px; text-align: center; font-size: 12px; }
        .rating-1 { background: #fee2e2; color: #991b1b; }
        .rating-2 { background: #fed7aa; color: #9a3412; }
        .rating-3 { background: #fef3c7; color: #92400e; }
        .rating-4 { background: #dbeafe; color: #1e40af; }
        .rating-5 { background: #d1fae5; color: #065f46; }
        .rating-item strong { display: block; font-size: 18px; margin-bottom: 5px; }
        .category { margin: 30px 0; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
        .category-header { background: linear-gradient(to right, #2563eb, #1d4ed8); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .category-avg { background: white; color: #1d4ed8; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; }
        .competency { padding: 20px; border-bottom: 1px solid #e5e7eb; }
        .competency:nth-child(even) { background: #f9fafb; }
        .competency:last-child { border-bottom: none; }
        .competency-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .competency-info { flex: 1; }
        .competency-name { font-weight: 600; color: #111827; margin-bottom: 5px; }
        .competency-desc { font-size: 14px; color: #6b7280; }
        .rating-buttons { display: flex; gap: 8px; }
        .rating-btn { width: 45px; height: 45px; border: 2px solid #d1d5db; background: #f9fafb; border-radius: 50%; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .rating-btn:hover { background: #e5e7eb; transform: scale(1.05); }
        .rating-btn.selected { background: #2563eb; color: white; border-color: #2563eb; transform: scale(1.1); }
        .justification { margin-top: 15px; padding-top: 15px; border-top: 2px solid #fca5a5; }
        .justification label { color: #991b1b; font-weight: 600; font-size: 14px; margin-bottom: 8px; display: block; }
        .justification textarea { width: 100%; padding: 10px; border: 2px solid #fca5a5; border-radius: 6px; background: #fef2f2; min-height: 80px; }
        .justification-warning { color: #dc2626; font-size: 12px; margin-top: 5px; }
        .summary-box { background: linear-gradient(to right, #ecfdf5, #dbeafe); border: 2px solid #10b981; border-radius: 12px; padding: 25px; margin: 30px 0; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .summary-item { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .summary-label { font-size: 12px; color: #6b7280; margin-bottom: 5px; }
        .summary-value { font-size: 32px; font-weight: bold; color: #2563eb; }
        .analysis-box { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .analysis-status { padding: 20px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 20px; margin-bottom: 15px; border: 2px solid; }
        .status-green { background: #d1fae5; color: #065f46; border-color: #10b981; }
        .status-blue { background: #dbeafe; color: #1e40af; border-color: #3b82f6; }
        .status-orange { background: #fed7aa; color: #9a3412; border-color: #f97316; }
        .status-darkorange { background: #fdba74; color: #7c2d12; border-color: #ea580c; }
        .status-red { background: #fee2e2; color: #991b1b; border-color: #ef4444; }
        .metrics-box { background: #f9fafb; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
        .recommendation-box { background: #eff6ff; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 4px; }
        .distribution { margin-top: 20px; }
        .distribution-item { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .distribution-badge { min-width: 45px; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
        .distribution-bar-container { flex: 1; }
        .distribution-label { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px; }
        .distribution-bar { background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden; }
        .distribution-bar-fill { height: 100%; transition: width 0.3s; }
        .submit-section { text-align: center; margin: 40px 0; padding: 30px; border-top: 2px solid #e5e7eb; }
        .submit-btn { background: #10b981; color: white; padding: 18px 40px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s; }
        .submit-btn:hover { background: #059669; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
        .submit-btn:disabled { background: #d1d5db; cursor: not-allowed; transform: none; }
        .success-box { background: #d1fae5; border: 2px solid #10b981; border-radius: 12px; padding: 25px; margin-bottom: 30px; }
        .success-title { color: #065f46; font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .download-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .download-btn { padding: 15px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .download-pdf { background: #dc2626; color: white; }
        .download-pdf:hover { background: #b91c1c; }
        .download-excel { background: #10b981; color: white; }
        .download-excel:hover { background: #059669; }
        .hidden { display: none; }
        @media print { body { background: white; } .container { box-shadow: none; } }
        @media (max-width: 768px) {
            .form-grid, .position-buttons, .summary-grid, .download-buttons { grid-template-columns: 1fr; }
            .rating-grid { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>OJT Performance Assessment Matrix</h1>
        <h2 id="positionTitle">Resource Planning Officer</h2>

        <div id="successBox" class="success-box hidden">
            <div class="success-title">âœ“ Assessment Submitted Successfully!</div>
            <p style="color: #065f46; margin-bottom: 15px;">You can now download the report in your preferred format.</p>
            <div class="download-buttons">
                <button class="download-btn download-pdf" onclick="exportToHTML()">ðŸ“„ Download as PDF/HTML</button>
                <button class="download-btn download-excel" onclick="exportToCSV()">ðŸ“Š Download as Excel/CSV</button>
            </div>
        </div>

        <div class="position-selector">
            <label>Select Position:</label>
            <div class="position-buttons">
                <div class="position-btn active" onclick="selectPosition('officer')" id="btnOfficer">
                    <strong>Resource Planning Officer</strong>
                    <small>(32 Competencies)</small>
                </div>
                <div class="position-btn" onclick="selectPosition('specialist')" id="btnSpecialist">
                    <strong>Resource Planning Specialist</strong>
                    <small>(36 Competencies - includes Problem-Solving)</small>
                </div>
            </div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Trainee Name *</label>
                <input type="text" id="traineeName" placeholder="Enter trainee name">
            </div>
            <div class="form-group">
                <label># SAP ID *</label>
                <input type="text" id="sapId" placeholder="Enter SAP ID">
            </div>
            <div class="form-group">
                <label>Supervisor/Evaluator *</label>
                <input type="text" id="supervisor" placeholder="Enter supervisor name">
            </div>
            <div class="form-group">
                <label>Evaluation Date *</label>
                <input type="date" id="evaluationDate">
            </div>
        </div>

        <div class="progress-bar">
            <strong>Progress:</strong> <span id="progressText">0 of 32 competencies rated (0%)</span>
            <div class="progress-bar-fill">
                <div class="progress-bar-fill-inner" id="progressBar" style="width: 0%"></div>
            </div>
        </div>

        <div class="rating-scale">
            <h3>Rating Scale</h3>
            <div class="rating-grid">
                <div class="rating-item rating-1"><strong>1</strong>Needs Significant Improvement</div>
                <div class="rating-item rating-2"><strong>2</strong>Needs Improvement</div>
                <div class="rating-item rating-3"><strong>3</strong>Satisfactory</div>
                <div class="rating-item rating-4"><strong>4</strong>Good</div>
                <div class="rating-item rating-5"><strong>5</strong>Excellent</div>
            </div>
        </div>

        <div id="competenciesContainer"></div>

        <div class="summary-box">
            <h2 style="margin-bottom: 20px;">Overall Assessment Summary</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Overall Average Rating</div>
                    <div class="summary-value" id="avgRating">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Competencies Assessed</div>
                    <div class="summary-value" style="color: #10b981;" id="totalRated">0 / 32</div>
                </div>
            </div>

            <div id="analysisContainer" class="hidden"></div>

            <div class="distribution">
                <h3 style="margin-bottom: 15px;">Rating Distribution:</h3>
                <div id="distributionContainer"></div>
            </div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Strengths & Accomplishments</label>
                <textarea id="strengths" rows="4" placeholder="Describe key strengths demonstrated during OJT..."></textarea>
            </div>
            <div class="form-group">
                <label>Areas for Development</label>
                <textarea id="areasForDevelopment" rows="4" placeholder="Identify areas where improvement is needed..."></textarea>
            </div>
        </div>
        <div class="form-group" style="margin-top: 20px;">
            <label>Recommendations</label>
            <textarea id="recommendations" rows="4" placeholder="Provide recommendations for future development..."></textarea>
        </div>

        <div class="submit-section">
            <button class="submit-btn" onclick="submitAssessment()" id="submitBtn">
                âœ“ Submit Assessment
            </button>
            <p style="margin-top: 15px; color: #6b7280; font-size: 14px;">
                Please ensure all competencies are rated and justifications are provided for ratings of 1 or 2
            </p>
        </div>
    </div>

    <script>
        let currentPosition = 'officer';
        let ratings = {};
        let comments = {};
        let isSubmitted = false;

        const competenciesData = {
            officer: [
                {
                    category: "Technical Skills",
                    items: [
                        { id: 1, skill: "Resource allocation and scheduling", description: "Ability to allocate resources efficiently and create realistic schedules" },
                        { id: 2, skill: "Capacity planning", description: "Understanding of resource capacity and workload balancing" },
                        { id: 3, skill: "IVU software proficiency", description: "Ability to use IVU software for resource planning and scheduling operations" },
                        { id: 4, skill: "Excel spreadsheet skills", description: "Proficiency in Excel for data analysis, formulas, pivot tables, and reporting" },
                        { id: 5, skill: "Project management tools proficiency", description: "Use of software like MS Project, Excel, or resource management systems" },
                        { id: 6, skill: "Data analysis and reporting", description: "Ability to analyze resource data and generate meaningful reports" },
                        { id: 7, skill: "Manpower forecasting", description: "Predicting future workforce requirements and staffing needs" },
                        { id: 8, skill: "Creating Duty", description: "Ability to create and define duty assignments with proper specifications and requirements" },
                        { id: 9, skill: "Week template", description: "Designing and managing weekly scheduling templates for consistent roster planning" },
                        { id: 10, skill: "Roster layout (Rollout of weekly template)", description: "Implementing and rolling out weekly templates into operational rosters" },
                        { id: 11, skill: "Adding leaves and Training requirement in the roster", description: "Incorporating leave requests and training schedules into roster planning" },
                        { id: 12, skill: "Plotting Duty in the roster considering all requirement for coverage", description: "Strategic duty assignment ensuring all operational coverage requirements are met" },
                        { id: 13, skill: "Rest Day alignment in case of movement", description: "Adjusting and aligning rest days when schedule changes or movements occur" }
                    ]
                },
                {
                    category: "Planning & Organization",
                    items: [
                        { id: 14, skill: "Strategic resource planning", description: "Long-term resource forecasting and planning" },
                        { id: 15, skill: "Priority management", description: "Ability to prioritize competing resource demands" },
                        { id: 16, skill: "Timeline development", description: "Creating realistic project timelines with resource constraints" },
                        { id: 17, skill: "Risk assessment", description: "Identifying resource-related risks and mitigation strategies" },
                        { id: 18, skill: "Documentation", description: "Maintaining accurate resource records and plans" },
                        { id: 19, skill: "Leave & TOIL balance checking and adjusting", description: "Monitoring and managing Time Off In Lieu (TOIL) and leave balances, making necessary adjustments" },
                        { id: 20, skill: "Annual leave planning and criteria knowledge", description: "Planning annual leave schedules and understanding annual leave count criteria and regulations" },
                        { id: 21, skill: "Annual leave slot distribution strategy", description: "Managing and distributing annual leave slots available throughout the year for optimal workforce coverage" }
                    ]
                },
                {
                    category: "Communication Skills",
                    items: [
                        { id: 22, skill: "Stakeholder communication", description: "Clear communication with managers, teams, and clients" },
                        { id: 23, skill: "Conflict resolution", description: "Addressing resource conflicts between departments/projects" },
                        { id: 24, skill: "Presentation skills", description: "Presenting resource plans and reports effectively" },
                        { id: 25, skill: "Written communication", description: "Clear documentation and email correspondence" },
                        { id: 26, skill: "Behavior, attitude, and manner", description: "Professional demeanor, positive attitude, and appropriate conduct in workplace interactions" }
                    ]
                },
                {
                    category: "Professional Attributes",
                    items: [
                        { id: 27, skill: "Attention to detail", description: "Accuracy in resource planning and tracking" },
                        { id: 28, skill: "Time management", description: "Managing own workload effectively" },
                        { id: 29, skill: "Initiative and proactivity", description: "Anticipating resource needs before issues arise" },
                        { id: 30, skill: "Teamwork and collaboration", description: "Working effectively with cross-functional teams" },
                        { id: 31, skill: "Handle high load work pressure", description: "Ability to maintain performance quality and composure during peak demand periods and stressful situations" },
                        { id: 32, skill: "Professional conduct", description: "Maintaining professionalism and work ethics" }
                    ]
                }
            ],
            specialist: [
                {
                    category: "Technical Skills",
                    items: [
                        { id: 1, skill: "Resource allocation and scheduling", description: "Ability to allocate resources efficiently and create realistic schedules" },
                        { id: 2, skill: "Capacity planning", description: "Understanding of resource capacity and workload balancing" },
                        { id: 3, skill: "IVU software proficiency", description: "Ability to use IVU software for resource planning and scheduling operations" },
                        { id: 4, skill: "Excel spreadsheet skills", description: "Proficiency in Excel for data analysis, formulas, pivot tables, and reporting" },
                        { id: 5, skill: "Project management tools proficiency", description: "Use of software like MS Project, Excel, or resource management systems" },
                        { id: 6, skill: "Data analysis and reporting", description: "Ability to analyze resource data and generate meaningful reports" },
                        { id: 7, skill: "Manpower forecasting", description: "Predicting future workforce requirements and staffing needs" },
                        { id: 8, skill: "Creating Duty", description: "Ability to create and define duty assignments with proper specifications and requirements" },
                        { id: 9, skill: "Week template", description: "Designing and managing weekly scheduling templates for consistent roster planning" },
                        { id: 10, skill: "Roster layout (Rollout of weekly template)", description: "Implementing and rolling out weekly templates into operational rosters" },
                        { id: 11, skill: "Adding leaves and Training requirement in the roster", description: "Incorporating leave requests and training schedules into roster planning" },
                        { id: 12, skill: "Plotting Duty in the roster considering all requirement for coverage", description: "Strategic duty assignment ensuring all operational coverage requirements are met" },
                        { id: 13, skill: "Rest Day alignment in case of movement", description: "Adjusting and aligning rest days when schedule changes or movements occur" }
                    ]
                },
                {
                    category: "Planning & Organization",
                    items: [
                        { id: 14, skill: "Strategic resource planning", description: "Long-term resource forecasting and planning" },
                        { id: 15, skill: "Priority management", description: "Ability to prioritize competing resource demands" },
                        { id: 16, skill: "Timeline development", description: "Creating realistic project timelines with resource constraints" },
                        { id: 17, skill: "Risk assessment", description: "Identifying resource-related risks and mitigation strategies" },
                        { id: 18, skill: "Documentation", description: "Maintaining accurate resource records and plans" },
                        { id: 19, skill: "Leave & TOIL balance checking and adjusting", description: "Monitoring and managing Time Off In Lieu (TOIL) and leave balances, making necessary adjustments" },
                        { id: 20, skill: "Annual leave planning and criteria knowledge", description: "Planning annual leave schedules and understanding annual leave count criteria and regulations" },
                        { id: 21, skill: "Annual leave slot distribution strategy", description: "Managing and distributing annual leave slots available throughout the year for optimal workforce coverage" }
                    ]
                },
                {
                    category: "Communication Skills",
                    items: [
                        { id: 22, skill: "Stakeholder communication", description: "Clear communication with managers, teams, and clients" },
                        { id: 23, skill: "Conflict resolution", description: "Addressing resource conflicts between departments/projects" },
                        { id: 24, skill: "Presentation skills", description: "Presenting resource plans and reports effectively" },
                        { id: 25, skill: "Written communication", description: "Clear documentation and email correspondence" },
                        { id: 26, skill: "Behavior, attitude, and manner", description: "Professional demeanor, positive attitude, and appropriate conduct in workplace interactions" }
                    ]
                },
                {
                    category: "Problem-Solving & Decision Making",
                    items: [
                        { id: 27, skill: "Critical thinking", description: "Analyzing complex resource scenarios" },
                        { id: 28, skill: "Decision-making under pressure", description: "Making quick resource allocation decisions when needed" },
                        { id: 29, skill: "Creative problem-solving", description: "Finding innovative solutions to resource constraints" },
                        { id: 30, skill: "Adaptability", description: "Adjusting plans when circumstances change" }
                    ]
                },
                {
                    category: "Professional Attributes",
                    items: [
                        { id: 31, skill: "Attention to detail", description: "Accuracy in resource planning and tracking" },
                        { id: 32, skill: "Time management", description: "Managing own workload effectively" },
                        { id: 33, skill: "Initiative and proactivity", description: "Anticipating resource needs before issues arise" },
                        { id: 34, skill: "Teamwork and collaboration", description: "Working effectively with cross-functional teams" },
                        { id: 35, skill: "Handle high load work pressure", description: "Ability to maintain performance quality and composure during peak demand periods and stressful situations" },
                        { id: 36, skill: "Professional conduct", description: "Maintaining professionalism and work ethics" }
                    ]
                }
            ]
        };

        function selectPosition(position) {
            currentPosition = position;
            ratings = {};
            comments = {};
            isSubmitted = false;
            
            document.getElementById('btnOfficer').classList.toggle('active', position === 'officer');
            document.getElementById('btnSpecialist').classList.toggle('active', position === 'specialist');
            document.getElementById('positionTitle').textContent = position === 'officer' ? 'Resource Planning Officer' : 'Resource Planning Specialist';
            document.getElementById('successBox').classList.add('hidden');
            
            renderCompetencies();
            updateProgress();
            updateSummary();
        }

        function renderCompetencies() {
            const container = document.getElementById('competenciesContainer');
            const competencies = competenciesData[currentPosition];
            
            container.innerHTML = competencies.map(category => `
                <div class="category">
                    <div class="category-header">
                        <h3>${category.category}</h3>
                        <span class="category-avg" id="avg-${category.category.replace(/\s+/g, '-')}" style="display:none;"></span>
                    </div>
                    ${category.items.map(item => `
                        <div class="competency">
                            <div class="competency-header">
                                <div class="competency-info">
                                    <div class="competency-name">${item.skill}</div>
                                    <div class="competency-desc">${item.description}</div>
                                </div>
                                <div class="rating-buttons">
                                    ${[1,2,3,4,5].map(rating => `
                                        <button class="rating-btn" id="btn-${item.id}-${rating}" onclick="setRating(${item.id}, ${rating})">${rating}</button>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="justification hidden" id="just-${item.id}">
                                <label>Justification Required *</label>
                                <textarea id="comment-${item.id}" oninput="updateComment(${item.id})" placeholder="Please explain why this rating was given and what improvement is needed..."></textarea>
                                <div class="justification-warning hidden" id="warn-${item.id}">Please provide a detailed justification (minimum 20 characters)</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function setRating(id, rating) {
            ratings[id] = rating;
            
            // Update button styles
            for(let i = 1; i <= 5; i++) {
                const btn = document.getElementById(`btn-${id}-${i}`);
                btn.classList.toggle('selected', i === rating);
            }
            
            // Show/hide justification
            const justBox = document.getElementById(`just-${id}`);
            if(rating <= 2) {
                justBox.classList.remove('hidden');
            } else {
                justBox.classList.add('hidden');
                delete comments[id];
            }
            
            updateProgress();
            updateSummary();
        }

        function updateComment(id) {
            const textarea = document.getElementById(`comment-${id}`);
            const warning = document.getElementById(`warn-${id}`);
            comments[id] = textarea.value;
            
            if(textarea.value.length < 20) {
                warning.classList.remove('hidden');
            } else {
                warning.classList.add('hidden');
            }
        }

        function updateProgress() {
            const total = currentPosition === 'officer' ? 32 : 36;
            const rated = Object.keys(ratings).length;
            const percentage = Math.round((rated / total) * 100);
            
            document.getElementById('progressText').textContent = `${rated} of ${total} competencies rated (${percentage}%)`;
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        function updateSummary() {
            const total = currentPosition === 'officer' ? 32 : 36;
            const rated = Object.keys(ratings).length;
            const values = Object.values(ratings);
            const avg = values.length > 0 ? (values.reduce((a,b) => a+b, 0) / values.length).toFixed(2) : '0';
            
            document.getElementById('avgRating').textContent = avg;
            document.getElementById('totalRated').textContent = `${rated} / ${total}`;
            
            // Update distribution
            const dist = {1:0, 2:0, 3:0, 4:0, 5:0};
            values.forEach(v => dist[v]++);
            
            const colors = ['rating-1', 'rating-2', 'rating-3', 'rating-4', 'rating-5'];
            const labels = ['Needs Significant Improvement', 'Needs Improvement', 'Satisfactory', 'Good', 'Excellent'];
            
            document.getElementById('distributionContainer').innerHTML = [1,2,3,4,5].map(i => {
                const count = dist[i];
                const pct = rated > 0 ? Math.round((count / rated) * 100) : 0;
                return `
                    <div class="distribution-item">
                        <div class="distribution-badge ${colors[i-1]}">${i}</div>
                        <div class="distribution-bar-container">
                            <div class="distribution-label">
                                <span>${labels[i-1]}</span>
                                <span><strong>${count}</strong> (${pct}%)</span>
                            </div>
                            <div class="distribution-bar">
                                <div class="distribution-bar-fill ${colors[i-1]}" style="width: ${pct}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Show analysis if all rated
            if(rated === total) {
                showAnalysis(parseFloat(avg), dist, rated);
            } else {
                document.getElementById('analysisContainer').classList.add('hidden');
            }
        }

        function showAnalysis(avgRating, distribution, totalRatings) {
            const criticalCount = distribution[1] + distribution[2];
            const criticalPercentage = (criticalCount / totalRatings) * 100;
            
            let status, statusClass, recommendation;
            
            if(avgRating >= 4.0 && criticalCount === 0) {
                status = 'PASS - EXCELLENT PERFORMANCE';
                statusClass = 'status-green';
                recommendation = 'The trainee has demonstrated excellent performance across all competencies. They are ready to work independently and can proceed to the next level. Consider this trainee for advanced responsibilities or mentorship roles.';
            } else if(avgRating >= 3.5 && criticalCount <= 2) {
                status = 'PASS - SATISFACTORY PERFORMANCE';
                statusClass = 'status-blue';
                recommendation = 'The trainee has achieved satisfactory performance overall. They are competent to perform the role with minimal supervision. Address the identified areas for development through on-the-job coaching and periodic reviews.';
            } else if(avgRating >= 3.0 && criticalPercentage <= 20) {
                status = 'CONDITIONAL PASS - REQUIRES IMPROVEMENT';
                statusClass = 'status-orange';
                recommendation = 'The trainee shows adequate performance but has notable areas requiring improvement. Recommend a 30-day improvement plan focusing on the competencies rated 3 or below. Schedule a follow-up assessment after the improvement period.';
            } else if(avgRating >= 2.5 || (criticalPercentage > 20 && criticalPercentage <= 40)) {
                status = 'RETAKE REQUIRED';
                statusClass = 'status-darkorange';
                recommendation = 'The trainee has not met the minimum standards required for this role. Recommend extending the OJT period by 60-90 days with focused training on deficient areas. Assign a dedicated mentor and conduct weekly progress reviews. A complete reassessment is required.';
            } else {
                status = 'FAIL - UNSUITABLE FOR ROLE';
                statusClass = 'status-red';
                recommendation = 'The trainee has demonstrated significant deficiencies across multiple critical competencies. Consider whether this role is appropriate for the trainee or if alternative positions would be more suitable. If continuation is desired, require a comprehensive retraining program of at least 3 months before reassessment.';
            }
            
            document.getElementById('analysisContainer').innerHTML = `
                <div class="analysis-box">
                    <h3 style="margin-bottom: 15px; font-size: 18px;">Assessment Analysis & Recommendation</h3>
                    <div class="analysis-status ${statusClass}">${status}</div>
                    <div class="metrics-box">
                        <p style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Performance Metrics:</p>
                        <ul style="list-style: none; padding-left: 0; font-size: 14px; color: #374151;">
                            <li style="margin-bottom: 5px;">â€¢ Overall Average: <strong>${avgRating.toFixed(2)}</strong></li>
                            <li style="margin-bottom: 5px;">â€¢ Critical Issues (Ratings 1-2): <strong>${criticalCount} (${criticalPercentage.toFixed(1)}%)</strong></li>
                            <li>â€¢ Total Competencies Rated: <strong>${totalRatings}</strong></li>
                        </ul>
                    </div>
                    <div class="recommendation-box">
                        <p style="font-weight: 600; margin-bottom: 10px; color: #1e40af; font-size: 14px;">Recommendation:</p>
                        <p style="color: #1e3a8a; font-size: 14px; line-height: 1.6;">${recommendation}</p>
                    </div>
                </div>
            `;
            document.getElementById('analysisContainer').classList.remove('hidden');
        }

        function submitAssessment() {
            const total = currentPosition === 'officer' ? 32 : 36;
            const rated = Object.keys(ratings).length;
            
            // Validation
            if(rated < total) {
                alert(`Please rate all ${total} competencies before submitting.`);
                return;
            }
            
            const needsJustification = Object.entries(ratings).filter(([id, rating]) => rating <= 2);
            const allJustified = needsJustification.every(([id]) => comments[id] && comments[id].length >= 20);
            
            if(!allJustified) {
                alert('Please provide detailed justifications (minimum 20 characters) for all ratings of 1 or 2.');
                return;
            }
            
            const traineeName = document.getElementById('traineeName').value;
            const sapId = document.getElementById('sapId').value;
            const supervisor = document.getElementById('supervisor').value;
            const evaluationDate = document.getElementById('evaluationDate').value;
            
            if(!traineeName || !sapId || !supervisor || !evaluationDate) {
                alert('Please fill in trainee name, SAP ID, supervisor, and evaluation date.');
                return;
            }
            
            isSubmitted = true;
            document.getElementById('successBox').classList.remove('hidden');
            document.getElementById('submitBtn').disabled = true;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function exportToHTML() {
            const positionTitle = currentPosition === 'officer' ? 'Resource Planning Officer' : 'Resource Planning Specialist';
            const traineeName = document.getElementById('traineeName').value || 'Not provided';
            const sapId = document.getElementById('sapId').value || 'Not provided';
            const supervisor = document.getElementById('supervisor').value || 'Not provided';
            const evaluationDate = document.getElementById('evaluationDate').value || 'Not provided';
            const avgRating = document.getElementById('avgRating').textContent;
            const totalRated = document.getElementById('totalRated').textContent;
            
            const analysisHTML = document.getElementById('analysisContainer').innerHTML;
            
            let categoriesHTML = '';
            const competencies = competenciesData[currentPosition];
            
            competencies.forEach(category => {
                let itemsHTML = '';
                category.items.forEach(item => {
                    const rating = ratings[item.id] || 'N/A';
                    const justification = (ratings[item.id] <= 2 && comments[item.id]) ? 
                        `<div style="margin-top:10px;padding:10px;background:#fef2f2;border-left:3px solid #ef4444;border-radius:4px;">
                            <div style="font-weight:bold;color:#991b1b;font-size:12px;margin-bottom:5px;">JUSTIFICATION:</div>
                            <div style="color:#7f1d1d;font-size:13px;">${comments[item.id]}</div>
                        </div>` : '';
                    
                    itemsHTML += `
                        <div style="padding:15px 20px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;">
                            <div style="flex:1;">
                                <div style="font-weight:bold;color:#111827;margin-bottom:5px;">${item.skill}</div>
                                <div style="font-size:14px;color:#6b7280;">${item.description}</div>
                                ${justification}
                            </div>
                            <div style="font-size:20px;font-weight:bold;padding:8px 16px;border-radius:6px;min-width:50px;text-align:center;background:${rating === 'N/A' ? '#f3f4f6' : rating == 1 ? '#fee2e2' : rating == 2 ? '#fed7aa' : rating == 3 ? '#fef3c7' : rating == 4 ? '#dbeafe' : '#d1fae5'};color:${rating === 'N/A' ? '#6b7280' : rating == 1 ? '#991b1b' : rating == 2 ? '#9a3412' : rating == 3 ? '#92400e' : rating == 4 ? '#1e40af' : '#065f46'};">
                                ${rating}
                            </div>
                        </div>
                    `;
                });
                
                categoriesHTML += `
                    <div style="background:white;margin-bottom:20px;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                        <div style="background:linear-gradient(to right,#2563eb,#1d4ed8);color:white;padding:15px 20px;">
                            <h3 style="margin:0;">${category.category}</h3>
                        </div>
                        ${itemsHTML}
                    </div>
                `;
            });
            
            const strengths = document.getElementById('strengths').value;
            const areas = document.getElementById('areasForDevelopment').value;
            const recs = document.getElementById('recommendations').value;
            
            const html = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>OJT Assessment - ${traineeName}</title></head>
<body style="font-family:Arial,sans-serif;max-width:1000px;margin:0 auto;padding:20px;background:#f5f5f5;">
<div style="background:linear-gradient(to right,#2563eb,#1d4ed8);color:white;padding:30px;border-radius:8px;margin-bottom:30px;">
<h1 style="margin:0 0 10px 0;">OJT Performance Assessment Report</h1>
<h2 style="margin:0;opacity:0.9;">${positionTitle}</h2></div>
<div style="background:white;padding:20px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
<div style="padding:10px;background:#f9fafb;border-left:4px solid #2563eb;"><div style="font-weight:bold;color:#374151;font-size:12px;text-transform:uppercase;margin-bottom:5px;">Trainee Name</div><div style="font-size:16px;color:#111827;">${traineeName}</div></div>
<div style="padding:10px;background:#f9fafb;border-left:4px solid #2563eb;"><div style="font-weight:bold;color:#374151;font-size:12px;text-transform:uppercase;margin-bottom:5px;">SAP ID</div><div style="font-size:16px;color:#111827;">${sapId}</div></div>
<div style="padding:10px;background:#f9fafb;border-left:4px solid #2563eb;"><div style="font-weight:bold;color:#374151;font-size:12px;text-transform:uppercase;margin-bottom:5px;">Supervisor</div><div style="font-size:16px;color:#111827;">${supervisor}</div></div>
<div style="padding:10px;background:#f9fafb;border-left:4px solid #2563eb;"><div style="font-weight:bold;color:#374151;font-size:12px;text-transform:uppercase;margin-bottom:5px;">Evaluation Date</div><div style="font-size:16px;color:#111827;">${evaluationDate}</div></div>
</div></div>
<div style="background:linear-gradient(to right,#ecfdf5,#dbeafe);border:2px solid #10b981;padding:20px;border-radius:8px;margin:20px 0;">
<h3 style="margin:0 0 15px 0;color:#111827;">Overall Assessment Summary</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
<div style="background:white;padding:15px;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div style="font-size:12px;color:#6b7280;margin-bottom:5px;">Overall Average Rating</div><div style="font-size:28px;font-weight:bold;color:#2563eb;">${avgRating}</div></div>
<div style="background:white;padding:15px;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);"><div style="font-size:12px;color:#6b7280;margin-bottom:5px;">Competencies Assessed</div><div style="font-size:28px;font-weight:bold;color:#10b981;">${totalRated}</div></div>
</div></div>
${analysisHTML}
${categoriesHTML}
${strengths ? `<div style="background:white;padding:20px;border-radius:8px;margin-top:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1);"><div style="font-weight:bold;color:#111827;margin-bottom:10px;padding-bottom:5px;border-bottom:2px solid #2563eb;">Strengths & Accomplishments</div><div style="color:#374151;line-height:1.6;">${strengths}</div></div>` : ''}
${areas ? `<div style="background:white;padding:20px;border-radius:8px;margin-top:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1);"><div style="font-weight:bold;color:#111827;margin-bottom:10px;padding-bottom:5px;border-bottom:2px solid #2563eb;">Areas for Development</div><div style="color:#374151;line-height:1.6;">${areas}</div></div>` : ''}
${recs ? `<div style="background:white;padding:20px;border-radius:8px;margin-top:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1);"><div style="font-weight:bold;color:#111827;margin-bottom:10px;padding-bottom:5px;border-bottom:2px solid #2563eb;">Recommendations</div><div style="color:#374151;line-height:1.6;">${recs}</div></div>` : ''}
<div style="margin-top:40px;padding-top:20px;border-top:2px solid #e5e7eb;text-align:center;color:#6b7280;font-size:12px;">
<p>Generated on ${new Date().toLocaleString()}</p><p>OJT Assessment Matrix - ${positionTitle}</p></div>
</body></html>`;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `OJT_Assessment_${positionTitle.replace(/\s+/g, '_')}_${traineeName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportToCSV() {
            const positionTitle = currentPosition === 'officer' ? 'Resource Planning Officer' : 'Resource Planning Specialist';
            const traineeName = document.getElementById('traineeName').value || 'Not provided';
            const sapId = document.getElementById('sapId').value || 'Not provided';
            const supervisor = document.getElementById('supervisor').value || 'Not provided';
            const evaluationDate = document.getElementById('evaluationDate').value || 'Not provided';
            const avgRating = document.getElementById('avgRating').textContent;
            const totalRated = document.getElementById('totalRated').textContent;
            
            let csv = `OJT Performance Assessment Report - ${positionTitle}\n\n`;
            csv += `Trainee Name:,${traineeName}\n`;
            csv += `SAP ID:,${sapId}\n`;
            csv += `Supervisor:,${supervisor}\n`;
            csv += `Evaluation Date:,${evaluationDate}\n\n`;
            csv += `Overall Average Rating:,${avgRating}\n`;
            csv += `Competencies Assessed:,${totalRated}\n\n`;
            
            csv += `Category,Competency,Description,Rating,Justification\n`;
            
            const competencies = competenciesData[currentPosition];
            competencies.forEach(category => {
                category.items.forEach(item => {
                    const rating = ratings[item.id] || 'N/A';
                    const justification = (ratings[item.id] <= 2 && comments[item.id]) ? 
                        comments[item.id].replace(/,/g, ';').replace(/"/g, "'") : '';
                    csv += `"${category.category}","${item.skill}","${item.description}",${rating},"${justification}"\n`;
                });
            });
            
            const strengths = document.getElementById('strengths').value;
            const areas = document.getElementById('areasForDevelopment').value;
            const recs = document.getElementById('recommendations').value;
            
            csv += `\n\nStrengths & Accomplishments:\n"${strengths}"\n\n`;
            csv += `Areas for Development:\n"${areas}"\n\n`;
            csv += `Recommendations:\n"${recs}"\n`;
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `OJT_Assessment_${positionTitle.replace(/\s+/g, '_')}_${traineeName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        renderCompetencies();
        updateProgress();
        updateSummary();
    </script>
</body>
</html>
